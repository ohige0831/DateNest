name: Release (Windows)
on:
  push:
    tags: ["v*"]
  workflow_dispatch: {}

jobs:
  build-win:
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Build exe (bundle Qt + resources)
        shell: pwsh
        run: |
          $opts = @(
            "--noconfirm",
            "-F","app.py",
            "-n","DateNest",
            "--noconsole",
            # 未使用の重いモジュールを除外
            "--exclude-module","PySide6.QtWebEngineCore",
            "--exclude-module","PySide6.QtWebEngineWidgets",
            "--exclude-module","PySide6.QtWebChannel",
            "--exclude-module","PySide6.QtQml",
            "--exclude-module","PySide6.QtQuick"
          )
          # リソースが必要ならだけ同梱
          if (Test-Path ui)   { $opts += @("--add-data","ui;ui") }
          if (Test-Path data) { $opts += @("--add-data","data;data") }
          pyinstaller @opts
